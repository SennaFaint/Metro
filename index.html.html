<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TimeTrack - Employee Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        .container {
            background: white;
            border-radius: 0;
            box-shadow: none;
            padding: 0;
            width: 100%;
            max-width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .app-header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
            letter-spacing: -0.5px;
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.9);
            margin: 0;
            font-size: 0.9rem;
            font-weight: 400;
        }

        .app-content {
            flex: 1;
            padding: 20px;
            background: #ecf0f1;
            overflow-y: auto;
        }

        /* Login Screen Styles */
        .login-screen {
            display: block;
            min-height: 100vh;
            background: #34495e;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-container {
            background: white;
            border-radius: 20px;
            padding: 40px 30px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .login-logo {
            font-size: 2.5rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .login-subtitle {
            color: #666;
            margin-bottom: 40px;
            font-size: 1.1rem;
        }

        .login-form {
            width: 100%;
        }

        .form-group {
            margin-bottom: 25px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #2c3e50;
        }

        .login-btn {
            background: #2c3e50;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 20px rgba(44, 62, 80, 0.3);
            width: 100%;
        }

        .login-btn:hover {
            background: #34495e;
            transform: translateY(-2px);
            box-shadow: 0 15px 30px rgba(44, 62, 80, 0.4);
        }

        /* Main App Styles */
        .main-app {
            display: none;
        }

        .user-info {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid #e9ecef;
        }

        .user-details {
            text-align: left;
        }

        .user-name {
            font-weight: 600;
            color: #333;
            font-size: 1.1rem;
            margin-bottom: 2px;
        }

        .user-role {
            color: #6c757d;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
        }

        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #c82333;
            transform: translateY(-1px);
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 15px;
            padding: 4px;
            margin-bottom: 20px;
            overflow-x: auto;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid #e9ecef;
        }

        .nav-tab {
            flex: 1;
            padding: 12px 16px;
            background: transparent;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: 100px;
            font-size: 0.9rem;
            text-align: center;
        }

        .nav-tab.active {
            background: #2c3e50;
            color: white;
            box-shadow: 0 4px 12px rgba(44, 62, 80, 0.3);
        }

        .nav-tab:hover:not(.active) {
            background: #f8f9fa;
            color: #495057;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Time Clock Styles */
        .status-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 4px solid #2c3e50;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid #e9ecef;
            border-left: 4px solid #2c3e50;
        }

        .status-text {
            font-size: 1.2rem;
            color: #333;
            margin-bottom: 10px;
        }

        .time-display {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .clock-btn {
            background: #2c3e50;
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 1.3rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 20px rgba(44, 62, 80, 0.3);
            margin: 10px;
        }

        .clock-btn:hover {
            background: #34495e;
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(44, 62, 80, 0.4);
        }

        .clock-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Camera Styles */
        .camera-container {
            display: none;
            margin: 30px 0;
        }

        .camera-container.active {
            display: block;
        }

        video {
            width: 100%;
            max-width: 400px;
            height: 300px;
            border-radius: 15px;
            background: #000;
            object-fit: cover;
        }

        .camera-controls {
            margin-top: 20px;
        }

        .capture-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 10px;
        }

        .capture-btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .cancel-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 10px;
        }

        .cancel-btn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .photo-preview {
            display: none;
            margin: 20px 0;
        }

        .photo-preview.active {
            display: block;
        }

        .photo-preview img {
            width: 100%;
            max-width: 300px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        /* Inventory Styles */
        .inventory-form {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid #e9ecef;
        }

        .inventory-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .inventory-title {
            color: #333;
            font-size: 1.2rem;
            font-weight: 600;
            margin: 0;
        }

        .bulk-update-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
        }

        .bulk-update-btn:hover {
            background: #218838;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
        }

        .bulk-update-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .inventory-search {
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 1rem;
            margin-bottom: 20px;
        }

        .search-input:focus {
            outline: none;
            border-color: #2c3e50;
        }

        .inventory-table-container {
            max-height: 500px;
            overflow-y: auto;
            border-radius: 10px;
            border: 2px solid #e1e5e9;
            margin-bottom: 20px;
        }

        .inventory-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        .inventory-table th {
            background: #2c3e50;
            color: white;
            padding: 15px 10px;
            text-align: left;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .inventory-table td {
            padding: 12px 10px;
            border-bottom: 1px solid #e1e5e9;
            vertical-align: middle;
        }

        .inventory-table tr:hover {
            background: #f8f9ff;
        }

        .inventory-table tr:last-child td {
            border-bottom: none;
        }

        .item-name {
            font-weight: bold;
            color: #333;
            font-size: 0.95rem;
        }

        .item-sku {
            font-weight: bold;
            color: #2c3e50;
            font-size: 0.9rem;
        }

        .item-qty {
            color: #666;
            font-size: 0.9rem;
            text-align: center;
        }

        .qty-input {
            width: 80px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            text-align: center;
            font-size: 0.9rem;
        }

        .qty-input:focus {
            outline: none;
            border-color: #2c3e50;
        }

        .update-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: background 0.3s ease;
        }

        .update-btn:hover {
            background: #218838;
        }

        .update-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .total-row {
            background: #ecf0f1 !important;
            border-top: 2px solid #2c3e50;
            font-weight: bold;
        }

        .total-row td {
            border-bottom: 2px solid #2c3e50 !important;
        }

        .total-row .item-name {
            color: #2c3e50;
            font-size: 1rem;
        }

        .sims-row {
            background: #fff3cd !important;
            border-top: 2px solid #ffc107;
        }

        .sims-row td {
            border-bottom: 2px solid #ffc107 !important;
        }

        .sims-row .item-name {
            color: #856404;
            font-size: 1rem;
            font-weight: bold;
        }

        .sims-input {
            width: 80px;
            padding: 8px;
            border: 2px solid #ffc107;
            border-radius: 5px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .sims-input:focus {
            outline: none;
            border-color: #e0a800;
        }

        .sims-update-btn {
            background: #ffc107;
            color: #212529;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: bold;
            transition: background 0.3s ease;
        }

        .sims-update-btn:hover {
            background: #e0a800;
        }

        .staged-row {
            background: #fff9c4 !important;
            border-left: 3px solid #f39c12 !important;
        }

        .staged-row:hover {
            background: #fff3a0 !important;
        }

        /* EOD Styles */
        .eod-form {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid #e9ecef;
        }

        .eod-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .eod-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 1rem;
        }

        .eod-input:focus {
            outline: none;
            border-color: #2c3e50;
        }

        .submit-eod-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 20px rgba(40, 167, 69, 0.3);
            width: 100%;
        }

        .submit-eod-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px rgba(40, 167, 69, 0.4);
        }

        /* History Styles */
        .history {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid #e9ecef;
        }

        .history h3 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .history-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #e9ecef;
        }

        .history-item.clock-in {
            border-left: 4px solid #28a745;
        }

        .history-item.clock-out {
            border-left: 4px solid #dc3545;
        }

        .history-item.inventory {
            border-left: 4px solid #ffc107;
        }

        .history-item.eod {
            border-left: 4px solid #17a2b8;
        }

        .history-time {
            font-weight: bold;
            color: #333;
        }

        .history-type {
            font-size: 0.9rem;
            color: #666;
        }

        /* Message Styles */
        .message {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: bold;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .current-time {
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 20px;
            text-align: center;
            background: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid #e9ecef;
        }

        @media (max-width: 768px) {
            .app-header {
                padding: 15px;
            }
            
            .logo {
                font-size: 1.5rem;
            }
            
            .app-content {
                padding: 15px;
            }
            
            .user-info {
                padding: 15px;
                margin-bottom: 15px;
            }
            
            .nav-tab {
                padding: 10px 12px;
                font-size: 0.85rem;
                min-width: 80px;
            }
            
            .inventory-header {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }
            
            .bulk-update-btn {
                width: 100%;
                padding: 12px;
            }
            
            .inventory-table-container {
                overflow-x: auto;
            }
            
            .inventory-table {
                min-width: 600px;
            }
            
            .inventory-table th,
            .inventory-table td {
                padding: 8px 6px;
                font-size: 0.85rem;
            }
            
            .qty-input {
                width: 60px;
                padding: 6px;
            }
            
            .update-btn {
                padding: 4px 8px;
                font-size: 0.8rem;
            }
            
            .eod-grid {
                grid-template-columns: 1fr;
            }
            
            .clock-btn {
                padding: 15px 30px;
                font-size: 1.1rem;
            }
            
            .time-display {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Screen -->
        <div class="login-screen" id="loginScreen">
            <div class="login-container">
                <div class="login-logo">‚è∞ TimeTrack</div>
                <div class="login-subtitle">Employee Management System</div>
                
                <div class="login-form">
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" id="username" placeholder="Enter your username">
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" placeholder="Enter your password">
                    </div>
                    <button class="login-btn" onclick="login()">
                        üîê Login
                    </button>
                </div>
                
                <div class="message" id="loginMessage" style="display: none;"></div>
            </div>
        </div>

        <!-- Main Application -->
        <div class="main-app" id="mainApp">
            <div class="app-header">
                <div class="logo">‚è∞ TimeTrack</div>
                <div class="subtitle">Employee Management System</div>
            </div>
            
            <div class="app-content">
                <div class="user-info">
                    <div class="user-details">
                        <div class="user-name" id="userName">John Doe</div>
                        <div class="user-role" id="userRole">Employee</div>
                    </div>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>

                <div class="current-time" id="currentTime"></div>

                <!-- Navigation Tabs -->
                <div class="nav-tabs" id="navTabs">
                    <button class="nav-tab active" onclick="showTab('timeclock')">‚è∞ Time Clock</button>
                    <button class="nav-tab" onclick="showTab('inventory')">üì¶ Inventory</button>
                    <button class="nav-tab" onclick="showTab('eod')">üí∞ End of Day</button>
                    <button class="nav-tab" id="activitiesTab" onclick="showTab('history')" style="display: none;">üìä Activities</button>
                </div>

            <!-- Time Clock Tab -->
            <div class="tab-content active" id="timeclockTab">
                <div class="status-card">
                    <div class="status-text" id="statusText">Ready to Clock In</div>
                    <div class="time-display" id="timeDisplay">--:--:--</div>
                </div>

                <div class="message" id="message" style="display: none;"></div>

                <div class="clock-buttons">
                    <button class="clock-btn" id="clockInBtn" onclick="startClockIn()">
                        üïê Clock In
                    </button>
                    <button class="clock-btn" id="clockOutBtn" onclick="startClockOut()" disabled>
                        üïï Clock Out
                    </button>
                </div>

                <div class="camera-container" id="cameraContainer">
                    <video id="video" autoplay playsinline></video>
                    <div class="camera-controls">
                        <button class="capture-btn" id="captureBtn" onclick="capturePhoto()">
                            üì∏ Take Picture
                        </button>
                        <button class="cancel-btn" onclick="cancelCamera()">
                            ‚ùå Cancel
                        </button>
                    </div>
                </div>

                <div class="photo-preview" id="photoPreview">
                    <img id="capturedPhoto" alt="Captured photo">
                    <div style="margin-top: 15px;">
                        <button class="capture-btn" onclick="confirmPhoto()">
                            ‚úÖ Confirm
                        </button>
                        <button class="cancel-btn" onclick="retakePhoto()">
                            üîÑ Retake
                        </button>
                    </div>
                </div>
            </div>

                <!-- Inventory Tab -->
                <div class="tab-content" id="inventoryTab">
                    <div class="inventory-form">
                        <div class="inventory-header">
                            <h3 class="inventory-title">üì¶ Mobile Device Inventory</h3>
                            <button class="bulk-update-btn" id="bulkUpdateBtn" onclick="bulkUpdateInventory()" disabled>
                                üì§ Upload Changes
                            </button>
                        </div>
                        <div class="inventory-search">
                            <input type="text" class="search-input" id="inventorySearch" placeholder="üîç Search by device name or SKU..." onkeyup="filterInventory()">
                        </div>
                        <div class="inventory-table-container">
                            <table class="inventory-table" id="inventoryTable">
                                <thead>
                                    <tr>
                                        <th>Device Name</th>
                                        <th>SKU</th>
                                        <th>Current Qty</th>
                                        <th>New Qty</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="inventoryTableBody">
                                    <!-- Inventory items will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- End of Day Tab -->
                <div class="tab-content" id="eodTab">
                    <div class="eod-form">
                        <h3 style="margin-bottom: 20px; color: #333; font-size: 1.2rem; font-weight: 600;">üí∞ End of Day Submission</h3>
                    <div class="eod-grid">
                        <div class="form-group">
                            <label>Cash Amount ($)</label>
                            <input type="number" class="eod-input" id="cashAmount" placeholder="0.00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>Credit Amount ($)</label>
                            <input type="number" class="eod-input" id="creditAmount" placeholder="0.00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>Boxes Count</label>
                            <input type="number" class="eod-input" id="boxesCount" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label>QPay Amount ($)</label>
                            <input type="number" class="eod-input" id="qpayAmount" placeholder="0.00" step="0.01">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Notes (Optional)</label>
                        <textarea class="eod-input" id="eodNotes" placeholder="Any additional notes..." rows="3" style="resize: vertical;"></textarea>
                    </div>
                    <button class="submit-eod-btn" onclick="submitEOD()">
                        üí∞ Submit End of Day
                    </button>
                </div>
            </div>

                <!-- Activities Tab -->
                <div class="tab-content" id="historyTab">
                    <div class="history">
                        <h3>üìä Activity History</h3>
                    <div id="historyList">
                        <div style="text-align: center; color: #666; padding: 20px;">
                            No activity today
                        </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let currentStream = null;
        let currentAction = null;
        let capturedImageData = null;
        let clockedIn = false;
        let clockInTime = null;
        let todayHistory = JSON.parse(localStorage.getItem('mobileSystemWideHistory') || '[]');
        let inventoryData = JSON.parse(localStorage.getItem('mobileInventoryData') || '[]');

        // Demo users (in real app, this would be server-side)
        const users = {
            'admin': { password: 'admin123', name: 'Admin User', role: 'Manager' },
            'employee': { password: 'emp123', name: 'Manoj', role: 'Employee' },
            'manager': { password: 'mgr123', name: 'Ali', role: 'Manager' },
            'owner': { password: 'owner123', name: 'Business Owner', role: 'Owner' }
        };

        // Initialize mobile device inventory data
        if (inventoryData.length === 0) {
            inventoryData = [
                { id: 1, name: 'Samsung Galaxy A13', sku: 'A13', currentQty: 0, unit: 'units' },
                { id: 2, name: 'Samsung Galaxy A15', sku: 'A15', currentQty: 3, unit: 'units' },
                { id: 3, name: 'Samsung Galaxy A16', sku: 'A16', currentQty: 0, unit: 'units' },
                { id: 4, name: 'Samsung Galaxy A35', sku: 'A35', currentQty: 0, unit: 'units' },
                { id: 5, name: 'Samsung Galaxy A36', sku: 'A36', currentQty: 0, unit: 'units' },
                { id: 6, name: 'TCL C210', sku: 'C210', currentQty: 0, unit: 'units' },
                { id: 7, name: 'Moto G310', sku: 'G310', currentQty: 0, unit: 'units' },
                { id: 8, name: 'Moto G400', sku: 'G400', currentQty: 0, unit: 'units' },
                { id: 9, name: 'HSI Device', sku: 'HSI', currentQty: 0, unit: 'units' },
                { id: 10, name: 'iPhone 13', sku: 'Iphone 13', currentQty: 0, unit: 'units' },
                { id: 11, name: 'iPhone 14', sku: 'Iphone 14', currentQty: 0, unit: 'units' },
                { id: 12, name: 'iPhone 16', sku: 'Iphone 16', currentQty: 0, unit: 'units' },
                { id: 13, name: 'iPhone 16 E', sku: 'Iphone 16 e', currentQty: 0, unit: 'units' },
                { id: 14, name: 'iPhone 16 Plus', sku: 'Iphone 16 plus', currentQty: 0, unit: 'units' },
                { id: 15, name: 'iPhone 16 Pro', sku: 'Iphone 16 pro', currentQty: 0, unit: 'units' },
                { id: 16, name: 'iPhone 16 Pro Max', sku: 'Iphone 16 pro max', currentQty: 0, unit: 'units' },
                { id: 17, name: 'Moto G 2024', sku: 'Moto g 2024', currentQty: 0, unit: 'units' },
                { id: 18, name: 'Moto G 2025', sku: 'Moto g 2025', currentQty: 0, unit: 'units' },
                { id: 19, name: 'Moto Power 2024', sku: 'Moto power 2024', currentQty: 0, unit: 'units' },
                { id: 20, name: 'Moto Power 2025', sku: 'Moto power 2025', currentQty: 0, unit: 'units' },
                { id: 21, name: 'Moto Razr 2024', sku: 'Moto razr 2024', currentQty: 0, unit: 'units' },
                { id: 22, name: 'Moto Stylus 2023', sku: 'Moto stylus 2023', currentQty: 0, unit: 'units' },
                { id: 23, name: 'Moto Stylus 2024', sku: 'Moto stylus 2024', currentQty: 0, unit: 'units' },
                { id: 24, name: 'Moto Stylus 2025', sku: 'Moto stylus 2025', currentQty: 0, unit: 'units' },
                { id: 25, name: 'Moto Edge 2024', sku: 'Moto edge 2024', currentQty: 0, unit: 'units' },
                { id: 26, name: 'Revvl 7', sku: 'Rewl 7', currentQty: 0, unit: 'units' },
                { id: 27, name: 'Revvl 7 Pro', sku: 'Rewl 7 pro', currentQty: 0, unit: 'units' },
                { id: 28, name: 'Samsung S23 FE', sku: 'S 23 FE', currentQty: 0, unit: 'units' },
                { id: 29, name: 'Samsung S24 FE', sku: 'S24 FE', currentQty: 0, unit: 'units' },
                { id: 30, name: 'TCL 50 XL 3', sku: 'TCL 50 XL 3', currentQty: 0, unit: 'units' },
                { id: 31, name: 'TCL K32', sku: 'TCL K32', currentQty: 0, unit: 'units' },
                { id: 32, name: 'TCL ION X', sku: 'TCL ION X', currentQty: 0, unit: 'units' },
                { id: 33, name: 'TCL K11', sku: 'TCL K11', currentQty: 0, unit: 'units' },
                { id: 34, name: 'Flip Phone 3', sku: 'Flip Phone 3', currentQty: 0, unit: 'units' },
                { id: 35, name: 'TCL Tab', sku: 'TCL Tab', currentQty: 0, unit: 'units' },
                { id: 36, name: 'Samsung Tab 3', sku: 'Samsung Tab 3', currentQty: 0, unit: 'units' },
                { id: 37, name: 'Samsung Watch', sku: 'Samsung Watch', currentQty: 0, unit: 'units' },
                { id: 38, name: 'Apple Watch', sku: 'Apple Watch', currentQty: 0, unit: 'units' },
                { id: 39, name: 'Chrome Book', sku: 'Chrome book', currentQty: 0, unit: 'units' },
                { id: 40, name: 'Google Pixel', sku: 'Google pixel', currentQty: 0, unit: 'units' },
                { id: 41, name: 'Revvl Tab', sku: 'Revvl Tab', currentQty: 0, unit: 'units' },
                { id: 42, name: 'Revvl 8', sku: 'Revll 8', currentQty: 0, unit: 'units' }
            ];
            localStorage.setItem('mobileInventoryData', JSON.stringify(inventoryData));
        }

        // Initialize SIM cards data
        let simCardsData = JSON.parse(localStorage.getItem('mobileSimCardsData') || '{"quantity": 0}');

        // Update current time display
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            const timeElement = document.getElementById('currentTime');
            if (timeElement) {
                timeElement.textContent = `Current Time: ${timeString}`;
            }
        }

        // Update time display every second
        setInterval(updateCurrentTime, 1000);
        updateCurrentTime();

        // Login function
        function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                showLoginMessage('Please enter both username and password', 'error');
                return;
            }

            if (users[username] && users[username].password === password) {
                currentUser = {
                    username: username,
                    name: users[username].name,
                    role: users[username].role
                };
                
                // Save login state
                localStorage.setItem('mobileCurrentUser', JSON.stringify(currentUser));
                
                // Show main app
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                
                // Update user info
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('userRole').textContent = currentUser.role;
                
                // Show/hide activities tab based on role
                const activitiesTabBtn = document.getElementById('activitiesTab');
                if (currentUser.role === 'Manager' || currentUser.role === 'Owner') {
                    activitiesTabBtn.style.display = 'block';
                } else {
                    activitiesTabBtn.style.display = 'none';
                }
                
                // Load app state
                loadState();
                displayInventory();
                
                showMessage('Login successful!', 'success');
            } else {
                showLoginMessage('Invalid username or password', 'error');
            }
        }

        // Logout function
        function logout() {
            currentUser = null;
            localStorage.removeItem('mobileCurrentUser');
            
            // Reset form
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            
            // Show login screen
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('mainApp').style.display = 'none';
            
            // Close camera if open
            if (currentStream) {
                closeCamera();
            }
        }

        // Show login message
        function showLoginMessage(text, type = 'success') {
            const message = document.getElementById('loginMessage');
            message.textContent = text;
            message.className = `message ${type}`;
            message.style.display = 'block';
            
            setTimeout(() => {
                message.style.display = 'none';
            }, 3000);
        }

        // Show tab function
        function showTab(tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Hide all nav buttons
            const navButtons = document.querySelectorAll('.nav-tab');
            navButtons.forEach(btn => btn.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Activate corresponding nav button
            event.target.classList.add('active');
            
            // Update displays based on tab
            if (tabName === 'history') {
                displayHistory();
            } else if (tabName === 'inventory') {
                displayInventory();
            }
        }

        // Load saved state
        function loadState() {
            const savedState = localStorage.getItem('mobileClockState');
            if (savedState) {
                const state = JSON.parse(savedState);
                clockedIn = state.clockedIn || false;
                clockInTime = state.clockInTime ? new Date(state.clockInTime) : null;
                updateUI();
            }
            displayHistory();
        }

        // Save state
        function saveState() {
            const state = {
                clockedIn: clockedIn,
                clockInTime: clockInTime
            };
            localStorage.setItem('mobileClockState', JSON.stringify(state));
        }

        // Update UI based on current state
        function updateUI() {
            const statusText = document.getElementById('statusText');
            const timeDisplay = document.getElementById('timeDisplay');
            const clockInBtn = document.getElementById('clockInBtn');
            const clockOutBtn = document.getElementById('clockOutBtn');

            if (clockedIn && clockInTime) {
                statusText.textContent = 'Currently Clocked In';
                timeDisplay.textContent = clockInTime.toLocaleTimeString();
                clockInBtn.disabled = true;
                clockOutBtn.disabled = false;
            } else {
                statusText.textContent = 'Ready to Clock In';
                timeDisplay.textContent = '--:--:--';
                clockInBtn.disabled = false;
                clockOutBtn.disabled = true;
            }
        }

        // Show message
        function showMessage(text, type = 'success') {
            const message = document.getElementById('message');
            message.textContent = text;
            message.className = `message ${type}`;
            message.style.display = 'block';
            
            setTimeout(() => {
                message.style.display = 'none';
            }, 3000);
        }

        // Time clock functions
        function startClockIn() {
            currentAction = 'clockin';
            openCamera();
        }

        function startClockOut() {
            currentAction = 'clockout';
            openCamera();
        }

        async function openCamera() {
            try {
                const constraints = {
                    video: {
                        width: { ideal: 640 },
                        height: { ideal: 480 },
                        facingMode: 'user'
                    }
                };

                currentStream = await navigator.mediaDevices.getUserMedia(constraints);
                const video = document.getElementById('video');
                video.srcObject = currentStream;
                
                document.getElementById('cameraContainer').classList.add('active');
                document.querySelector('.clock-buttons').style.display = 'none';
                
            } catch (error) {
                console.error('Error accessing camera:', error);
                showMessage('Unable to access camera. Please check permissions.', 'error');
            }
        }

        function capturePhoto() {
            const video = document.getElementById('video');
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0);
            
            capturedImageData = canvas.toDataURL('image/jpeg', 0.8);
            
            const capturedPhoto = document.getElementById('capturedPhoto');
            capturedPhoto.src = capturedImageData;
            document.getElementById('photoPreview').classList.add('active');
            
            document.getElementById('cameraContainer').classList.remove('active');
        }

        function confirmPhoto() {
            const now = new Date();
            
            if (currentAction === 'clockin') {
                clockedIn = true;
                clockInTime = now;
                addToHistory('Clock In', now, capturedImageData);
                showMessage('Successfully clocked in!');
            } else if (currentAction === 'clockout') {
                if (clockedIn && clockInTime) {
                    const duration = calculateDuration(clockInTime, now);
                    addToHistory('Clock Out', now, capturedImageData, duration);
                    showMessage(`Successfully clocked out! Total time: ${duration}`);
                }
                clockedIn = false;
                clockInTime = null;
            }
            
            saveState();
            updateUI();
            closeCamera();
            hidePhotoPreview();
        }

        function retakePhoto() {
            hidePhotoPreview();
            openCamera();
        }

        function cancelCamera() {
            closeCamera();
            hidePhotoPreview();
        }

        function closeCamera() {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
                currentStream = null;
            }
            document.getElementById('cameraContainer').classList.remove('active');
            document.querySelector('.clock-buttons').style.display = 'block';
            currentAction = null;
        }

        function hidePhotoPreview() {
            document.getElementById('photoPreview').classList.remove('active');
            capturedImageData = null;
        }

        // Inventory functions
        function displayInventory() {
            const tableBody = document.getElementById('inventoryTableBody');
            tableBody.innerHTML = '';
            
            const searchTerm = document.getElementById('inventorySearch').value.toLowerCase();
            const filteredItems = inventoryData.filter(item => 
                item.name.toLowerCase().includes(searchTerm) || 
                item.sku.toLowerCase().includes(searchTerm)
            );
            
            // Display regular inventory items
            filteredItems.forEach(item => {
                const row = document.createElement('tr');
                const isStaged = pendingChanges.has(`inventory-${item.id}`);
                const stagedClass = isStaged ? 'staged-row' : '';
                const stagedIndicator = isStaged ? 'üìù ' : '';
                
                row.className = stagedClass;
                row.innerHTML = `
                    <td>
                        <div class="item-name">${stagedIndicator}${item.name}</div>
                    </td>
                    <td>
                        <div class="item-sku">${item.sku}</div>
                    </td>
                    <td>
                        <div class="item-qty">${item.currentQty} ${item.unit}</div>
                    </td>
                    <td>
                        <input type="number" class="qty-input" id="qty-${item.id}" placeholder="0" min="0" value="" onchange="trackPendingChanges()">
                    </td>
                    <td>
                        <button class="update-btn" onclick="stageInventoryUpdate(${item.id})">Stage</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            // Calculate and display total row (only if no search filter)
            if (searchTerm === '') {
                const totalQty = inventoryData.reduce((sum, item) => sum + item.currentQty, 0);
                const totalRow = document.createElement('tr');
                totalRow.className = 'total-row';
                totalRow.innerHTML = `
                    <td>
                        <div class="item-name">üì± Total Phones</div>
                    </td>
                    <td>
                        <div class="item-sku">TOTAL</div>
                    </td>
                    <td>
                        <div class="item-qty">${totalQty} units</div>
                    </td>
                    <td>-</td>
                    <td>-</td>
                `;
                tableBody.appendChild(totalRow);

                // Display SIM cards row
                const simsRow = document.createElement('tr');
                const isSimsStaged = pendingChanges.has('sims');
                const simsClass = isSimsStaged ? 'sims-row staged-row' : 'sims-row';
                const simsIndicator = isSimsStaged ? 'üìù ' : '';
                
                simsRow.className = simsClass;
                simsRow.innerHTML = `
                    <td>
                        <div class="item-name">${simsIndicator}üì∂ SIM Cards</div>
                    </td>
                    <td>
                        <div class="item-sku">SIMS</div>
                    </td>
                    <td>
                        <div class="item-qty">${simCardsData.quantity} units</div>
                    </td>
                    <td>
                        <input type="number" class="sims-input" id="simsQty" placeholder="0" min="0" value="" onchange="trackPendingChanges()">
                    </td>
                    <td>
                        <button class="sims-update-btn" onclick="stageSimCardsUpdate()">Stage</button>
                    </td>
                `;
                tableBody.appendChild(simsRow);
            }
        }

        function filterInventory() {
            displayInventory();
        }

        function stageInventoryUpdate(itemId) {
            const newQty = parseInt(document.getElementById(`qty-${itemId}`).value);
            
            if (isNaN(newQty) || newQty < 0) {
                showMessage('Please enter a valid quantity', 'error');
                return;
            }
            
            const item = inventoryData.find(i => i.id === itemId);
            if (item) {
                // Just stage the change, don't apply it yet
                pendingChanges.add(`inventory-${itemId}`);
                trackPendingChanges();
                showMessage(`Staged ${item.name} quantity change to ${newQty} units`, 'success');
            }
        }

        function stageSimCardsUpdate() {
            const newQty = parseInt(document.getElementById('simsQty').value);
            
            if (isNaN(newQty) || newQty < 0) {
                showMessage('Please enter a valid SIM cards quantity', 'error');
                return;
            }
            
            // Just stage the change, don't apply it yet
            pendingChanges.add('sims');
            trackPendingChanges();
            showMessage(`Staged SIM Cards quantity change to ${newQty} units`, 'success');
        }

        // Bulk update functionality
        let pendingChanges = new Set();

        function trackPendingChanges() {
            pendingChanges.clear();
            
            // Check inventory items
            inventoryData.forEach(item => {
                const input = document.getElementById(`qty-${item.id}`);
                if (input && input.value !== '' && parseInt(input.value) !== item.currentQty) {
                    pendingChanges.add(`inventory-${item.id}`);
                }
            });
            
            // Check SIM cards
            const simsInput = document.getElementById('simsQty');
            if (simsInput && simsInput.value !== '' && parseInt(simsInput.value) !== simCardsData.quantity) {
                pendingChanges.add('sims');
            }
            
            // Update bulk update button state
            const bulkBtn = document.getElementById('bulkUpdateBtn');
            if (pendingChanges.size > 0) {
                bulkBtn.disabled = false;
                bulkBtn.textContent = `üì§ Upload ${pendingChanges.size} Changes`;
            } else {
                bulkBtn.disabled = true;
                bulkBtn.textContent = 'üì§ Upload Changes';
            }
        }

        function bulkUpdateInventory() {
            if (pendingChanges.size === 0) {
                showMessage('No changes to upload', 'error');
                return;
            }

            let updatedItems = [];
            let allUpdatesSuccessful = true;

            // Process inventory updates
            inventoryData.forEach(item => {
                if (pendingChanges.has(`inventory-${item.id}`)) {
                    const input = document.getElementById(`qty-${item.id}`);
                    const newQty = parseInt(input.value);
                    
                    if (!isNaN(newQty) && newQty >= 0) {
                        const oldQty = item.currentQty;
                        item.currentQty = newQty;
                        updatedItems.push(`${item.name} (${item.sku}): ${oldQty} ‚Üí ${newQty} units`);
                        input.value = ''; // Clear input after update
                    } else {
                        allUpdatesSuccessful = false;
                    }
                }
            });

            // Process SIM cards update
            if (pendingChanges.has('sims')) {
                const simsInput = document.getElementById('simsQty');
                const newQty = parseInt(simsInput.value);
                
                if (!isNaN(newQty) && newQty >= 0) {
                    const oldQty = simCardsData.quantity;
                    simCardsData.quantity = newQty;
                    updatedItems.push(`SIM Cards: ${oldQty} ‚Üí ${newQty} units`);
                    simsInput.value = ''; // Clear input after update
                } else {
                    allUpdatesSuccessful = false;
                }
            }

            if (updatedItems.length > 0) {
                // Save to localStorage
                localStorage.setItem('mobileInventoryData', JSON.stringify(inventoryData));
                localStorage.setItem('mobileSimCardsData', JSON.stringify(simCardsData));
                
                // Add bulk update to history
                const summary = `Bulk Update: ${updatedItems.join(', ')}`;
                addToHistory('Bulk Inventory Update', new Date(), null, null, summary);
                
                // Refresh display
                displayInventory();
                
                // Reset pending changes
                pendingChanges.clear();
                trackPendingChanges();
                
                showMessage(`‚úÖ Uploaded! Successfully updated ${updatedItems.length} items.`, 'success');
            } else {
                showMessage('No valid updates to process', 'error');
            }
        }

        // EOD functions
        function submitEOD() {
            const cashAmount = parseFloat(document.getElementById('cashAmount').value) || 0;
            const creditAmount = parseFloat(document.getElementById('creditAmount').value) || 0;
            const boxesCount = parseInt(document.getElementById('boxesCount').value) || 0;
            const qpayAmount = parseFloat(document.getElementById('qpayAmount').value) || 0;
            const notes = document.getElementById('eodNotes').value.trim();
            
            const eodData = {
                date: new Date().toDateString(),
                cash: cashAmount,
                credit: creditAmount,
                boxes: boxesCount,
                qpay: qpayAmount,
                notes: notes,
                total: cashAmount + creditAmount + qpayAmount,
                submittedBy: currentUser.name,
                submittedAt: new Date().toISOString()
            };
            
            // Save EOD data
            let eodHistory = JSON.parse(localStorage.getItem('mobileEodHistory') || '[]');
            eodHistory.push(eodData);
            localStorage.setItem('mobileEodHistory', JSON.stringify(eodHistory));
            
            // Add to activity history
            const summary = `Cash: $${cashAmount}, Credit: $${creditAmount}, Boxes: ${boxesCount}, QPay: $${qpayAmount}`;
            addToHistory('EOD Submission', new Date(), null, null, summary);
            
            // Clear form
            document.getElementById('cashAmount').value = '';
            document.getElementById('creditAmount').value = '';
            document.getElementById('boxesCount').value = '';
            document.getElementById('qpayAmount').value = '';
            document.getElementById('eodNotes').value = '';
            
            showMessage(`EOD submitted successfully! Total: $${eodData.total.toFixed(2)}`, 'success');
        }

        // History functions
        function addToHistory(action, timestamp, photo, duration = null, details = null) {
            const historyItem = {
                action: action,
                timestamp: timestamp.toISOString(),
                photo: photo,
                duration: duration,
                details: details,
                user: currentUser ? currentUser.name : 'Unknown',
                userRole: currentUser ? currentUser.role : 'Unknown',
                userId: currentUser ? currentUser.username : 'unknown'
            };
            
            todayHistory.push(historyItem);
            localStorage.setItem('mobileSystemWideHistory', JSON.stringify(todayHistory));
        }

        function calculateDuration(startTime, endTime) {
            const diff = endTime - startTime;
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            return `${hours}h ${minutes}m`;
        }

        function displayHistory() {
            const historyList = document.getElementById('historyList');
            
            // Filter activities based on user role
            let activitiesToShow = [];
            
            if (currentUser && (currentUser.role === 'Manager' || currentUser.role === 'Owner')) {
                // Managers and Owners see ALL activities
                activitiesToShow = todayHistory.slice();
            } else {
                // Employees see only their own activities
                activitiesToShow = todayHistory.filter(item => 
                    item.userId === (currentUser ? currentUser.username : 'unknown')
                );
            }
            
            if (activitiesToShow.length === 0) {
                const noActivityMessage = (currentUser && (currentUser.role === 'Manager' || currentUser.role === 'Owner')) 
                    ? 'No system activity today' 
                    : 'No activity today';
                historyList.innerHTML = `<div style="text-align: center; color: #666; padding: 20px;">${noActivityMessage}</div>`;
                return;
            }
            
            historyList.innerHTML = '';
            
            // Sort by timestamp (newest first)
            activitiesToShow.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            activitiesToShow.forEach(item => {
                const historyItem = document.createElement('div');
                const actionClass = item.action.toLowerCase().replace(' ', '-').replace(/\s+/g, '-');
                historyItem.className = `history-item ${actionClass}`;
                
                const time = new Date(item.timestamp).toLocaleTimeString();
                const duration = item.duration ? ` (${item.duration})` : '';
                const details = item.details ? `<br><small>${item.details}</small>` : '';
                const icon = getActionIcon(item.action);
                
                // Show user info for managers/owners, hide for employees viewing their own
                const userInfo = (currentUser && (currentUser.role === 'Manager' || currentUser.role === 'Owner')) 
                    ? `<br><small><strong>${item.user}</strong> (${item.userRole})</small>` 
                    : '';
                
                historyItem.innerHTML = `
                    <div>
                        <div class="history-time">${time}</div>
                        <div class="history-type">${item.action}${duration}${userInfo}${details}</div>
                    </div>
                    <div>${icon}</div>
                `;
                
                historyList.appendChild(historyItem);
            });
        }

        function getActionIcon(action) {
            switch (action.toLowerCase()) {
                case 'clock in': return 'üïê';
                case 'clock out': return 'üïï';
                case 'inventory update': return 'üì¶';
                case 'bulk inventory update': return 'üì§';
                case 'sim cards update': return 'üì∂';
                case 'eod submission': return 'üí∞';
                default: return 'üìã';
            }
        }

        // Clear history at midnight
        function checkNewDay() {
            const today = new Date().toDateString();
            const lastDate = localStorage.getItem('mobileLastDate');
            
            if (lastDate !== today) {
                todayHistory = [];
                localStorage.setItem('mobileSystemWideHistory', JSON.stringify(todayHistory));
                localStorage.setItem('mobileLastDate', today);
                
                clockedIn = false;
                clockInTime = null;
                saveState();
                updateUI();
                displayHistory();
            }
        }

        // Check for new day every minute
        setInterval(checkNewDay, 60000);

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is already logged in
            const savedUser = localStorage.getItem('mobileCurrentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('userRole').textContent = currentUser.role;
                
                // Show/hide activities tab based on role
                const activitiesTabBtn = document.getElementById('activitiesTab');
                if (currentUser.role === 'Manager' || currentUser.role === 'Owner') {
                    activitiesTabBtn.style.display = 'block';
                } else {
                    activitiesTabBtn.style.display = 'none';
                }
                
                loadState();
                displayInventory();
            }
            
            checkNewDay();
            
            // Add enter key support for login
            document.getElementById('password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });
        });

        // Handle page visibility change to stop camera
        document.addEventListener('visibilitychange', function() {
            if (document.hidden && currentStream) {
                closeCamera();
            }
        });
    </script>
</body>
</html>
